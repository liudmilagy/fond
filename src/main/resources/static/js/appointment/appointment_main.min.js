import{view_header,changeContentView,main_body_width,main_padding}from"../general.min.js";webix.Date.startOnMonday=!0,webix.i18n.setLocale("ru-RU");const appointmentStep1Main={view:"dataview",id:"appointment_datatable",xCount:1,header:!1,select:"row",scroll:!1,borderless:!0,type:{height:100,width:"auto",template:"<div class='btn_click'><img src='#attachmentPath#' style='width:100px; height: 100px;  object-fit: cover; padding-right: 10px; ' align='left'><div style='font-weight: bolder; font-size: larger'>#name#</div><div> #description#</div></div>"},onClick:{btn_click:function(e,t,i){let n=$$("appointment_datatable").getItem(t);$$("appointmentMultiviewId").getChildViews()[1].show(),$$("idTypeAppointment").setValue(n.id),$$("nameTypeAppointment").setValue(n.name)}},url:"type_appointments"};function appointmentStep1(){return document.body.clientWidth<main_body_width?appointmentStep1Main:{cols:[{},appointmentStep1Main,{}]}}var calendarView={weekHeader:!1,weekNumber:!1,view:"calendar",on:{onChange:function(e){$$("timeListId").clearAll(),$$("timeListId").hide(),$$("noTimeId").hide();let t={id_type_appointment:$$("idTypeAppointment").getValue(),date_string:dateFormat(e)};$$("chosenDateId").setValue(dateFormat(e));let i=webix.ajax().sync().get("free_times",t);if(""!=i.responseText&&"[]"!=i.responseText){let e=JSON.parse(i.responseText);$$("timeListId").parse(e),$$("timeListId").show(),$$("timeListId").select(!1)}else $$("noTimeId").show();$$("gotoStep3").hide()}}};const appointmentStep2={id:"appointmentStep2Id",cols:[{},{rows:[calendarView,{id:"noTimeId",view:"label",label:"Нет записи",hidden:!0},{view:"list",id:"timeListId",select:!0,borderless:!0,scroll:!0,type:{width:"auto",height:"auto"},hidden:!0,on:{onItemClick:()=>{$$("gotoStep3").show()}}},{view:"button",value:"Продолжить",id:"gotoStep3",css:"webix_primary",hidden:!0,click:()=>{$$("chosenTimeId").setValue($$("timeListId").getSelectedItem().value),$$("appointmentMultiviewId").getChildViews()[2].show()}},{}]},{}]},appointmentStep3Main={rows:[{view:"label",id:"idTypeAppointment",hidden:!0},{view:"text",id:"nameTypeAppointment",label:"",labelPosition:"top",disabled:!0},{cols:[{view:"text",id:"chosenDateId",label:"Дата",labelPosition:"top",disabled:!0},{view:"text",id:"chosenTimeId",label:"Время",labelPosition:"top",disabled:!0}]},{view:"text",id:"clientNameId",label:"Имя",labelPosition:"top",required:!0},{view:"text",id:"phoneNumberId",label:"Номер телефона",labelPosition:"top"},{view:"text",id:"emailId",label:"Email",labelPosition:"top"},{view:"textarea",id:"messageId",height:150,label:"Сообщение",labelPosition:"top"},{cols:[{view:"button",value:"Записаться",css:"webix_primary",maxWidth:200,click:()=>{$$("appointmentMultiviewId").disable();var e={idTypeAppointment:$$("idTypeAppointment").getValue(),date:$$("chosenDateId").getValue(),time:$$("chosenTimeId").getValue(),clientName:$$("clientNameId").getValue(),phoneNumber:$$("phoneNumberId").getValue(),email:$$("emailId").getValue(),message:$$("messageId").getValue()};webix.ajax().headers({"Content-Type":"application/json"}).post("save_client_appointment",e).then(function(e){$$("appointmentMultiviewId").hide(),webix.message("Вы успешно записаны!","success")})}},{}]},{}]};function appointmentStep3(){return document.body.clientWidth<main_body_width?appointmentStep3Main:{cols:[{},appointmentStep3Main,{}]}}function dateFormat(e){var t=webix.Date.dateToStr("%d.%m.%Y");return e?e.length?e.map(e=>t(new Date(e))).join(","):t(e):""}export const appointment={view:"scrollview",autoheight:!0,id:"appointmentId",scroll:"y",body:{rows:[{id:"normativeDocsHeaderId",template:"Онлайн запись",css:"other_tab_main_title",borderless:!0,align:"center",autoheight:!0},{view:"multiview",id:"appointmentMultiviewId",minHeight:700,cells:[appointmentStep1(),appointmentStep2,appointmentStep3()]},{}]}};