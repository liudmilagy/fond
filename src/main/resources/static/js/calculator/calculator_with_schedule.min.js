import{view_header,main_padding,main_body_width,numberFormatWithoutDecimal,getOtherWidth,collapsedSideBarWidth}from"../general.min.js";export function calculateAnnuity(){if($$("calculatorDatatableId").clearAll(),$$("monthlyPaymentId").setValue(""),$$("overPaymentId").setValue(""),$$("calculatorResultId").hide(),""!=$$("amountId").getValue()&&""!=$$("limitationId").getValue()&&$$("limitationId").getValue()>0&&""!=$$("rateId").getValue()&&$$("rateId").getValue()>0&&$$("rateId").getValue()<100){$$("calculatorResultId").show();var e=1,t=$$("rateId").getValue(),a=.01*t/12,i=$$("limitationId").getValue(),l=$$("amountId").getValue().toString();l=l.replace(" ","");var r=parseInt(l),o=getMonthlyPayment(t,r,i),d=getOverPayment(t,r,i);$$("monthlyPaymentId").setValue(webix.Number.format(o,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "})),$$("overPaymentId").setValue(webix.Number.format(d,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}));for(var m=r;e<=i;e++){var u=getMainDebt(o,a,e,i);m-=u;var n={index:e,monthlyPayment:webix.Number.format(o,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}),mainDebt:webix.Number.format(u,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}),percentDebt:webix.Number.format(o-u,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}),balanceOwed:webix.Number.format(m,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "})};$$("calculatorDatatableId").add(n)}}}export function calculateDifferentiated(){if($$("calculatorDatatableId").clearAll(),$$("monthlyPaymentId").setValue(""),$$("overPaymentId").setValue(""),$$("calculatorResultId").hide(),""!=$$("amountId").getValue()&&""!=$$("limitationId").getValue()&&$$("limitationId").getValue()>0&&""!=$$("rateId").getValue()&&$$("rateId").getValue()>0&&$$("rateId").getValue()<100){$$("calculatorResultId").show();var e=1,t=$$("rateId").getValue(),a=$$("limitationId").getValue(),i=$$("amountId").getValue().toString();i=i.replace(" ","");var l=parseInt(i),r="",o="",d=0;for(e=1;e<=a;e++){var m=getPercentDebtDifferentiated(t,l,a,e);d+=m;var u=l/a+m;1===e?r=u:e.toString()===a&&(o=u);var n=l/a,c=l-n*e,$={index:e,monthlyPayment:webix.Number.format(u,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}),mainDebt:webix.Number.format(n,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}),percentDebt:webix.Number.format(m,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}),balanceOwed:webix.Number.format(c,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "})};$$("calculatorDatatableId").add($)}var s=webix.Number.format(o,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}),g=webix.Number.format(r,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "});$$("monthlyPaymentId").setValue(s+" ... "+g),$$("overPaymentId").setValue(webix.Number.format(d,{groupSize:3,decimalSize:2,decimalDelimiter:".",groupDelimiter:" "}))}}function calculator_form(e){return{rows:[{padding:20,rows:[{view:"template",id:"contactsHeaderId",css:"product_label_main_title",template:"Калькулятор",borderless:!0,align:"center",autoheight:!0}]},{cols:[{rows:[{view:"text",id:"amountId",maxWidth:750,label:"Размер займа, руб.",labelPosition:e,labelWidth:250,required:!0,format:"1 111"},{view:"text",id:"limitationId",maxWidth:750,label:"Срок, мес.",labelPosition:e,labelWidth:250,required:!0,validate:function(e){return!isNaN(1*e)},attributes:{type:"number"}},{view:"text",id:"rateId",maxWidth:750,label:"Процентная ставка, %",labelPosition:e,labelWidth:250,required:!0,validate:function(e){return!isNaN(1*e)},attributes:{type:"number"}},{view:"richselect",id:"typeId",label:"Вид платежа",labelPosition:e,labelWidth:250,hidden:!0,value:2,options:[{id:1,value:"Аннуитетный"},{id:2,value:"Дифференцированный"}]}]},{}]},{cols:[{view:"button",id:"calculateBtnId",value:"Рассчитать",css:"fond",maxWidth:250,click:()=>{"1"===$$("typeId").getValue()?calculateAnnuity():calculateDifferentiated()}},{}]},{view:"form",id:"calculatorResultId",hidden:!0,padding:0,rows:[{cols:[{rows:[{view:"text",id:"monthlyPaymentId",css:{"background-color":"transparent"},label:"Ежемесячный платеж, руб.",labelPosition:"top",readonly:!0},{view:"text",id:"overPaymentId",label:"Переплата по процентам, руб.",labelPosition:"top",readonly:!0}]},{}]},{view:"label",label:"График платежей"},{view:"datatable",id:"calculatorDatatableId",autoheight:!0,select:"row",multiselect:!1,columns:[{id:"index",header:"№ месяца",fillspace:1,adjust:!0},{id:"monthlyPayment",header:"Сумма платежа, руб",fillspace:3,adjust:!0},{id:"mainDebt",header:"Выплата основного долга, руб",fillspace:3,adjust:!0},{id:"percentDebt",header:"Выплата процентов, руб",fillspace:3,adjust:!0},{id:"balanceOwed",header:"Остаток долга, руб",fillspace:4,adjust:!0}]}]}]}}export function calculator_with_schedule(e){return e?{view:"scrollview",scroll:"xy",body:{cols:[{width:getOtherWidth()},{margin:20,padding:10,borderless:!0,rows:[calculator_form("left")]},{width:getOtherWidth()}]}}:{view:"scrollview",scroll:"xy",body:{rows:[{borderless:!0,rows:[calculator_form("top")]}]}}}function getMonthlyPayment(e,t,a){var i=.01*e/12;return(i+i/(Math.pow(1+i,a)-1))*t}function getOverPayment(e,t,a){var i=.01*e/12;return(i+i/(Math.pow(1+i,a)-1))*t*a-t}function getMainDebt(e,t,a,i){return e*Math.pow(1+t,a-i-1)}function getPercentDebtDifferentiated(e,t,a,i){return(t-(i-1)*(t/a))*(.01*e*31/365)}function setCalculatorResultValues(e){var t=getRate(e,$$("programRichselectId").getValue(),$$("depositId").getValue());$$("rateLabelId").setValue(t),$$("monthlyPaymentId").setValue(getMonthlyPayment(t,$$("amountSliderId").getValue(),$$("timeSliderId").getValue())),$$("overPaymentId").setValue(getOverPayment(t,$$("amountSliderId").getValue(),$$("timeSliderId").getValue()))}export function setCalculatorValues(e){$$("programRichselectId").setValue(e),$$("depositId").setValue(e),$$("amountSliderId").config.min=e.minAmountWithDeposit,$$("amountSliderId").config.max=e.maxAmountWithDeposit,$$("amountSliderId").setValue(e.minAmountWithDeposit),$$("timeSliderId").config.max=e.limitation,$$("timeSliderId").setValue(e.limitation)}